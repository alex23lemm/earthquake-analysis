
# Analysis of earthquake activity in 2014 around Darmstadt, Germany

## Synopysis

In May and June 2014 several earthquakes struck the region west of Darmstadt (Germany). In this report we will use the earthquake data provided by the [Bundesanstalt f√ºr Geowissenschaften und Rohstoffe][BGR] and the ggmap package to create different maps. 

__Note:__ This analysis was inspired by [Bob's (Rudis) blog post][] about  the series of earthquakes which hit California in March 2014.

```{r}

library(ggplot2)
library(ggmap)
library(dplyr)
library(httr)
library(XML)
library(stringr)
library(lubridate)

```

## Downloading and processing data

```{r}

# Download entire earthquake data from 2014 for Germany
page <- GET('http://www.seismologie.bgr.de/cgi-bin/eisy_test_iframe.pl?begin_date=20140101&end_date=20140713&min_lat=&max_lat=&min_lon=&max_lon=&min_mag=&max_mag=&')
page_content <- content(page, 'text')

parsed_content <- xmlRoot(htmlParse(page_content))
doc <- xpathSApply(parsed_content, '//pre', xmlValue)
head(doc)

data <- doc[-1]

date <- str_sub(data, 1, 10) 
time <- str_sub(data, 11, 17) %>% str_trim 
lat <- str_sub(data, 18, 25) %>% str_trim 
long <- str_sub(data, 26, 32) %>% str_trim 
mag <- str_sub(data, 33, 38) %>% str_trim 
region <- str_sub(data, 39, str_length(data)) %>% str_trim

preprocessed_data <- data.frame(date, time, lat, long, mag, region, 
                             stringsAsFactors = FALSE)

# Only include earthquakes around Darmstadt and change order so that older
# earthquakes will get plotted at first
processed_data <- filter(preprocessed_data, grepl('.*Darmstadt.*', region)) %>%
  transform(
    date  = dmy(date),
    lat   = as.numeric(lat),
    long  = as.numeric(long),
    mag   = as.numeric(mag)
    ) %>%
  arrange(date)

```

```{r}


```


## Plotting data

```{r}

# Get toner map of Darmstadt from Stamen
da_toner <- get_map('Darmstadt', maptype = 'toner', source = 'stamen')

# Create plot
ggmap(da_toner) +
  geom_point(aes(long, lat, size = mag, fill = mag), processed_data, 
             shape = 21, alpha = 0.7) +
  scale_size_continuous(limits = c(2,4)) +
  scale_fill_gradientn(colours = rev(terrain.colors(10)), limits=c(2,4), 
                       guide = guide_legend())

```

[Bob's (Rudis) blog post]: http://rud.is/b/2014/04/01/mapping-the-march-2014-california-earthquake-with-ggmap/

[BGR]: http://www.bgr.bund.de/DE/Themen/Erdbeben-Gefaehrdungsanalysen/Seismologie/Seismologie/Erdbebenauswertung/D_seit_1968/d_1968_node.html
